<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Rednote Downloader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{background:#0B1221;color:#E6EAF2}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px}
    .btn{background:#2563EB;color:white;padding:.6rem 1rem;border-radius:12px;font-weight:800}
    .input{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:.7rem .9rem;border-radius:.8rem;width:100%}
    .muted{opacity:.85}
  </style>
</head>
<body>
  <header class="max-w-2xl mx-auto px-4 py-6">
    <div class="text-2xl font-extrabold">Rednote Downloader</div>
    <div class="muted text-sm">Unduh media dari link publik Rednote (xhslink.com / xiaohongshu.com). Tidak melewati login/DRM.</div>
  </header>

  <main class="max-w-2xl mx-auto px-4 pb-24 space-y-6">
    <section class="card p-5 space-y-4">
      <div class="font-bold text-lg">Tempel Link Posting Rednote</div>
      <div>
        <input id="xhs" class="input" placeholder="https://xhslink.com/... atau https://www.xiaohongshu.com/...">
      </div>
      <label class="flex items-center gap-2 text-sm"><input id="agree" type="checkbox">Saya punya izin untuk mengunduh konten ini.</label>
      <div class="flex items-center gap-2">
        <button id="btnDownload" class="btn">Download Rednote</button>
      </div>
      <div id="xhsOut" class="text-sm"></div>
    </section>

    <section class="card p-5">
      <div class="font-bold mb-2">Catatan Hukum</div>
      <p class="muted text-sm">
        Alat ini <b>tidak</b> mem-bypass login, paywall, atau DRM. Hanya memproses konten yang sudah publik.
        Pastikan Anda memiliki izin yang sesuai dari pemilik konten.
      </p>
    </section>
  </main>

  <script>
    const $ = id => document.getElementById(id);

    $('btnDownload').addEventListener('click', async () => {
      const url = $('xhs').value.trim();
      $('xhsOut').textContent = 'Memproses...';
      if (!url) return $('xhsOut').textContent = 'Tempel link postingan dulu.';
      if (!$('agree').checked) return $('xhsOut').textContent = 'Centang pernyataan izin terlebih dahulu.';

      const data = await fetch('/api/resolve/rednote?url=' + encodeURIComponent(url)).then(r=>r.json()).catch(()=>({ok:false, error:'Gagal'}));
      if (!data.ok) return $('xhsOut').textContent = data.error || 'Gagal resolve.';

      let html = '';
      if (data.title) html += `<div class="mb-2"><b>Judul:</b> ${data.title}</div>`;
      if (data.cover) html += `<img class="rounded mb-2 max-h-48" src="${data.cover}" />`;
      if (data.media?.length) {
        html += '<div class="mb-2"><b>Media ditemukan:</b></div>';
        data.media.forEach((m,i)=>{
          const dl = `/api/download?url=${encodeURIComponent(m.url)}&filename=${encodeURIComponent('rednote-'+(i+1))}&referer=${encodeURIComponent(data.page)}`;
          html += `<div class="mb-2 p-2 rounded bg-white/5 border border-white/10">
                     <div class="text-xs muted">${m.type}</div>
                     <div class="truncate">${m.url}</div>
                     <a class="btn mt-2 inline-block" href="${dl}">Download</a>
                   </div>`;
        });
      }
      $('xhsOut').innerHTML = html || 'Tidak ada media langsung yang ditemukan.';
    });
  </script>
</body>
</html>
